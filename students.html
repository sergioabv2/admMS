<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootcards/1.1.1/js/bootcards.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootcards/1.1.1/css/bootcards-desktop.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"></script>
   <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.77,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.5.0"></script>

 

<style> 
  
  body{
    background: white;
    margin-top: -50px;
  }
  
a.list-group-item:before {
  content: '';
}
  

.list-group-item {
  margin-left: 0px;
  padding-left: 15px;
}

.list-group-item .row > div.col-sm-5 {
  margin-left: 10px;
}

.list-group-item .row > div.col-sm-6 {
  margin-left: -10px;
}

.panel-title {
  margin-top: 13px;
  margin-right: 7px;
}

.list-group-item-heading,
.list-group-item-text {
  padding-left: 3px;
}



@media only screen and (max-width: 767px) {
  .list-group-item .row > div.col-sm-5 {
    margin-left: 0px;
    padding-left: 5px;
  }
  .list-group-item-heading {
    margin-top: 3px;
  }
  
  .mobile-back-btn {
    display: block;
    margin-bottom: 15px;
  }
  
  .companies-panel {
    display: none;
  }
  
  .list-panel {
    display: block;
  }
}

@media (min-width: 768px) and (max-width: 911px) {
  #search {
    padding-left: 0px;
  }
  
  .mobile-back-btn {
    display: none;
  }
  
  .companies-panel {
    display: block;
  }
  
  .list-panel {
    display: block;
  }
}

@media (min-width: 912px) {
  .mobile-back-btn {
    display: none;
  }
  
  .companies-panel {
    display: block;
  }
  
  .list-panel {
    display: block;
  }
}

  @media(min-width: 769px){
.companies-panel {
      position: sticky !important;
      top: 20px; 
      width: 45%;

      overflow-y: auto;


    }
  }
  
.mobile-back-btn {
  margin-bottom: 15px;
}
  
  

.message-container.unread {
  background-color: #f5f5f5;
  border-left: 3px solid #337ab7;
}

.message-content {
  margin-top: 10px;
  margin-left: 58px; /* Alineado con el avatar */
}

.media {
  margin-top: 0;
}

.btnPreview{
  transform: scale(0.9)
}

#attendanceBtn {
  cursor: pointer;
  padding: 10px;
  border-radius: 50%;
  transition: all 0.3s;
}

#attendanceBtn:hover {
  background-color: #f5f5f5;
}

.modal-content {
  border-radius: 0;
}

.modal-header {
  background-color: #f8f9fa;
  border-bottom: 1px solid #e9ecef;
}
  
  /* Eliminar el fondo del midi-player y sus partes internas */
midi-player {
  --midi-player-background: transparent !important;
  --midi-player-controls-background: transparent !important;
  background: transparent !important;
}

/* Si el componente usa shadow parts */
midi-player::part(control-panel) {
  background: transparent !important;
}

midi-player::part(background) {
  background: transparent !important;
}


/*-----------------------
    Audio Player - AP
------------------------*/
.ap {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 64px;
  font-family: inherit;
  font-size: 14px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  border-top: 1px solid #ccc;
  background: #f2f2f2;
  box-shadow: 0 -1px 10px rgba(0, 0, 0, 0.1);
  z-index: 99999;
  display: none;
}

.ap__inner {
  display: flex;
  max-width: 1440px;
  margin: auto;
}

.ap__item {
  display: flex;
  justify-content: center;
  align-items: center;
}

.ap__item--player {
  flex: 2; /* Ocupa 2 partes del espacio disponible */
  min-width: 0; /* Permite que el contenido se ajuste correctamente */
  justify-content: flex-start; /* Alinea el contenido a la izquierda */
  padding-left: 15px; /* Espaciado opcional */
}

.ap__item--settings {
  flex: 1; /* Ocupa 1 parte del espacio disponible */
  justify-content: flex-end; /* Alinea los botones a la derecha */
  padding-right: 15px; /* Espaciado opcional */
}

.track__title {
  position: absolute;
  top: 2px;
  left: 17px;
  font-size: 12px; /* Tamaño pequeño */
  font-weight: 500;
  color: #666;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  z-index: 2;
  padding: 0 5px;
}

.ap__item--playback > .ap__controls,
.ap__item--settings > .ap__controls {
  flex: 0 25%;
  margin-top: -7px;
}

.ap__controls i{
  margin-top: -10px !important;
}

@-webkit-keyframes fs {
  0% {
    opacity: 0;
    transform: scale(0.5);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes fs {
  0% {
    opacity: 0;
    transform: scale(0.5);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}




.progress__preload {
  background: #c4c4c4;
  z-index: 0;
}

.ap__controls,
.ap button {
  margin: 0;
  padding: 0;
  border: 0;
  outline: 0;
  background: transparent;
  position: relative;
  display: block;
  height: 50px;
  text-align: center;
  cursor: pointer;
  transition: background 0.3s ease;
}

.ap__controls:active,
.ap button:active {
  background: rgba(0, 0, 0, 0.1);
}
.ap__controls:hover,
.ap button:hover {
  opacity: 1;
}



.ap__controls.is-active > svg {
  fill: steelblue;
  filter: drop-shadow(0 0 3px rgba(70, 130, 180, 0.4));
}

@media (max-width: 1024px) {
  .ap__item > .ap__controls {
    flex: 1;
  }
}
@media (max-width: 580px) {
  .ap {
    min-width: 250px;
  }

  .ap, .ap__inner {
    height: auto;
  }

  .ap__inner {
    flex-wrap: wrap;
  }

  .ap__item--player{
    margin-bottom: -5px;
  }


   .ap__item--player,
  .ap__item--settings {
    flex: 1 1 50% !important; /* Media query tiene prioridad */
    order: 2;
    min-width: initial;
    justify-content: center;
margin: 0;
  }
  
  .ap__item--settings {
    margin-top: -10px;
     margin-bottom: 10px;
  }
}
</style>

<div ng-app="companyApp" ng-controller="companyController" class="container">
  <div class="row">
    <div class="bootcards-list col-sm-6 list-panel">
      <div class="panel panel-default">
        <div class="panel-body">
      <form>
  <!-- Fila 1: Input + botón de búsqueda -->
  <div class="row">
    <div class="col-xs-8">
      <div class="form-group">
        <input type="text" class="form-control" placeholder="Search student" ng-model="searchQuery">
        <i class="fa fa-search"></i>
      </div>
    </div>
    <div class="col-xs-4">
          <div class="form-group">
         <select class="form-control" ng-model="selectedFilter" ng-change="applyFilter()">
      <option value="active">Activo</option>
      <option value="now">Ahora</option>
      <option value="today">Hoy</option>
      <option value="all">Todos</option>
    </select>
    </div>
    </div>
  </div>

  <!-- Fila 2: Botones de ordenamiento -->
  <div class="row" style="margin-top: 10px;">
    <div class="col-xs-12" >
      <button class="btn btn-default" style="color: black" ng-click="filterByHour()">Presencial</button>
      <button class="btn btn-default" style="color: black" ng-click="filterByDay()">Online</button>
      <button class="btn btn-default" style="color: black" ng-click="showAllStudents()">Plataforma</button>
    </div>
  </div>
</form>


        </div>
        <div class="list-group">
          <a class="list-group-item" href="#" ng-repeat="company in filteredStudents | filter:searchQuery" ng-click="showCompany(company.name, $event)">
            <div class="row">
              <div class="col-sm-1">
                <img style="border-radius: 50%;" ng-src="{{company.photo}}">
              </div>
              <div class="col-sm-5">
                <h4 class="list-group-item-heading">{{company.name}}</h4>
                <p class="list-group-item-text">{{company.status}}</p>
              </div>
              <div class="col-sm-6">
                <p class="list-group-item-text">{{company.level}}</p>
                <p class="list-group-item-text">{{company.classtime}}</p>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
    <div class="col-sm-6 companies-panel" >
      <button class="btn btn-default mobile-back-btn" ng-click="backToList()">
        <i class="fa fa-arrow-left"></i> Back to List
      </button>
      
      <div class="panel panel-default company-detail" ng-repeat="company in companies" ng-if="selectedCompany == company.name">
        <div class="panel-heading clearfix">
        
          <h3 class="panel-title pull-left" ng-if="company.status == 'ACTIVO'"> <i class="ri-progress-8-line" style="color: #28a745; text-shadow: 0 0 10px #28a745; margin-right: 4px"></i> ACTIVO </h3>
 <h3 class="panel-title pull-left" ng-if="company.status == 'PENDING'"> <i class="ri-progress-8-line" style="color: orange; text-shadow: 0 0 10px orange; margin-right: 4px"></i> PENDIENTE </h3>

  <h3 class="panel-title pull-left" ng-if="company.status == 'INACTIVO'"> <i class="ri-progress-8-line" style="color: red; text-shadow: 0 0 10px red; margin-right: 4px"></i> INACTIVO </h3>
         <button class="btn btn-default pull-right" ng-if="company.status != 'ACTIVO'">
            Registrar pago
          </button> 
        </div>
        
        
        <div class="list-group">
           <div class="list-group-item">
               <img class="pull-left" style="border-radius: 50%; width: 65px; height: 65px; margin-top: 4px; margin-right: 10px;" ng-src="{{company.photo}}">
            <h4 class="list-group-item-heading">
             {{company.name}}
              </h4>
            <p class="list-group-item-text">{{company.mail}}</p>
             <p class="list-group-item-text">{{company.level}}</p>
     
          </div>
          
       <div class="list-group-item" ng-show="activeTab === 'Analytics'">  

      
         
        <div class="panel panel-default">
    <div class="panel-body" style="height: 260px; overflow-y: auto;">
      <!-- Lista de grabaciones -->
      <div ng-repeat="lsn in company.currentLsn" class="recording-container">
        <div class="media">
          <div class="media-left" style="cursor: pointer;" ng-click="toggleLsn(lsn)">
            <i class="ri-time-line fa-2x" ng-if="lsn.status != 'Evaluada'"></i>
             <i class="ri-check-line fa-2x" style="color: green; opacity: 0.8; text-shadow: 0 0 10px green;" ng-if="lsn.status == 'Evaluada'"></i>
          </div>
          <div class="media-body">
            <h5 class="media-heading">
              {{lsn.name}}
   
                <button class="btn btn-default btnPreview pull-right" style="width: 62px;" ng-click="abrirNuevaPestana(lsn.pdf);$event.preventDefault();$event.stopPropagation()">
              Abrir
            </button>
            </h5>
            <p style="margin-bottom: -20px; font-size: 12px; font-weight: 400">
              <span ng-if="lsn.status == 'Evaluada'" class="text-success">
                Evaluado
              </span>
              <span ng-if="lsn.status != 'Evaluada'" class="text-warning">
                Pendiente
              </span>
            </p>
          </div>
     
        </div>
        <hr ng-if="!$last">
      </div>
    </div>



 <div class="panel-footer">
      <button class="btn btn-primary btn-block" ng-click="openEditModal2(company)">
       <i class="ri-edit-2-line"></i>Editar
      </button>
    </div>
   
  </div>
             </div>
          
          
   <div class="list-group-item" id="Agenda" ng-show="activeTab === 'Agenda'">
  <div class="panel panel-default">
   
    <div class="panel-body" style="height: 260px; overflow-y: auto;">
      <!-- Lista de mensajes -->

        <div ng-if="company.agenda && company.agenda.length > 0">
      <div ng-repeat="event in company.agenda" class="message-container" >
        
        <!-- Cabecera del mensaje -->
        <div class="media">
          <div class="media-left" style="cursor: pointer;" ng-click="toggleAttendance(event)">
             <span ng-if="event.attendance === 1" >
              <i class="ri-check-line fa-2x" style="color: green; opacity: 0.8; text-shadow: 0 0 10px green;"></i>
            </span>
            <span ng-if="event.attendance === 0" >
              <i class="ri-close-line fa-2x" style="color: red; opacity: 0.8; text-shadow: 0 0 10px red;"></i>
            </span>
              <span ng-if="event.attendance === ''" >
              <i class="ri-subtract-line fa-2x"></i>
            </span>
          </div>
          <div class="media-body" >
            <h5 class="media-heading">{{event.title}}
              <small class="text-muted pull-right" style="cursor: pointer">Editar</small>
            </h5>
            <p style="margin-bottom: -20px; font-size: 12px; color: gray; font-weight: 400">{{returnDateFormat(event.start)}}</p>
            <br ng-if="$last">
          </div>
        
        </div>
        <hr ng-if="!$last">
      </div>
        </div>

         <div ng-if="!company.agenda || company.agenda.length === 0" class="text-center" style="padding: 20px;">
        <i class="fa fa-calendar fa-4x" style="color: #ddd;"></i>
        <h4>No existen fechas</h4>
        <p>Aún no hay fechas registradas</p>
      </div>


    </div>
 <div class="panel-footer">
    <button class="btn btn-primary btn-block" ng-click="openEditModal(company)">
       <i class="ri-edit-2-line"></i>Editar
      </button>
    </div>
  </div>
</div> 
          



<div class="list-group-item" id="Messages" ng-show="activeTab === 'Messages'">
  <div class="panel panel-default">
    <div class="panel-body" style="height: 260px; overflow-y: auto;">
      <!-- Lista de grabaciones -->
      <div ng-if="company.audios && company.audios.length > 0">
      <div ng-repeat="recording in company.audios" class="recording-container">
        <div class="media">
          <div class="media-left">
            <i class="fa fa-music fa-2x"></i>
          </div>
          <div class="media-body">
            <h5 class="media-heading">
              {{recording.lesson}}
  
               <button class="btn btn-default btnPreview pull-right" style="width: 62px;" ng-click="openPlayer(recording)"><i class="fa fa-play"></i></button>
            </h5>
            <p style=" font-size: 12px; font-weight: 400; color: gray">
               {{returnDateFormat(recording.date)}}
            </p>
          </div>
       
        </div>
        <hr ng-if="!$last">
      </div>
        </div>

         <div ng-if="!company.audios || company.audios.length === 0" class="text-center" style="padding: 20px;">
        <i class="fa fa-music fa-4x" style="color: #ddd;"></i>
        <h4>No existen archivos</h4>
        <p>Aún no hay grabaciones registradas</p>
      </div>

    </div>
   
  </div>
</div>

          
          
        </div>
        
        
        
        
    <div class="panel-footer">
  <div class="btn-group btn-group-justified">
    <div class="btn-group">
      <button class="btn btn-default" ng-click="showTab('Analytics')">
       <i class="ri-folder-open-line"></i> Evaluación
      </button>
    </div>
    <div class="btn-group">
      <button class="btn btn-default" ng-click="showTab('Agenda')">
        <i class="ri-calendar-line"></i> Agenda
      </button>
    </div>
    <div class="btn-group">
      <button class="btn btn-default" ng-click="showTab('Messages')">
       <i class="ri-record-circle-line"></i> Grabación
      </button>
    </div>
  </div>
</div>
        
        



        
        
      </div>
    </div>

                  <!-- Modal -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Opciones</h4>
      </div>
      <div class="modal-body">
        <select class="form-control" ng-model="selectedOption">
          <option value="1">Agregar evento</option>
          <option value="2">Registrar pago</option>
        </select>
        
        <!-- Contenido dinámico según opción -->
        <div ng-if="selectedOption == '1'" style="margin-top: 15px;">
          <div class="form-group">
            <label>Título del evento</label>
            <input type="text" class="form-control" ng-model="newEvent.title">
          </div>
          <div class="form-group">
            <label>Fecha y hora</label>
            <input type="datetime-local" class="form-control" ng-model="newEvent.date">
          </div>
        </div>
        
        <div ng-if="selectedOption == '2'" style="margin-top: 15px;">
          <div class="form-group">
            <label>Fecha de pago</label>
            <input type="date" class="form-control" ng-model="paymentDate" ng-init="paymentDate = today">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" ng-click="processOption()">Continuar</button>
      </div>
    </div>
  </div>
</div>




                  <!-- Modal2 -->
<div class="modal fade" id="editModal2" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Opciones</h4>
      </div>
      <div class="modal-body">
        <select class="form-control" ng-model="selectedOption2">
          <option value="1">Aprobar todo</option>
          <option value="2">Asignar nivel</option>
           <option value="3">Agregar actividad</option>
        </select>
         
        <!-- Contenido dinámico según opción -->
        <div ng-if="selectedOption2 == '2'" style="margin-top: 15px;">
         
        </div>
        
        <div ng-if="selectedOption2 == '3'" style="margin-top: 15px;">
         
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" ng-click="processOption2()">Continuar</button>
      </div>
    </div>
  </div>
</div>



                                 <!-- Player -->
   
 
<div class="ap" id="ap">
   <div class="ap__inner">
  
      <div class="ap__item ap__item--player">
 <div class="track__title">{{currentRecording.lesson}}</div>
         <midi-player 
          id="midiPlayer"
          sound-font 
          visualizer="#midiVisualizer"
          style="width: 100%">
        </midi-player>
      </div>
      <div class="ap__item ap__item--settings">
          <button class="ap__controls" id="commentAudioBtn">
               <i class="ri-message-3-line fa-2x"></i>
          </button>
        <button class="ap__controls" id="checkAudioBtn">
           <i class="ri-checkbox-circle-line fa-2x"></i>
        </button>
        <button class="ap__controls" id="closeAudioBtn" ng-click="closePlayer()">
          <i class="ri-close-circle-fill fa-2x"></i>
        </button>
      </div>
  </div>
</div>



  </div>
</div>

<script>
angular.module('companyApp', [])
  .controller('companyController', ['$http', '$scope', function($http, $scope) {

    $scope.companies = [];


   var requestData = {
                action: "getAdminData",
                token: "U2FsdGVkX18LC0oGisKqGLC5uGXpU9h3zw8tJYi5QZDfYwdF32/rwVQsfq3hqkBE"
     //localStorage.getItem('ADtoken')
              };

              var config = {
                headers: {
                  "Content-Type": "text/plain;charset=utf-8"
                },
                followRedirects: true
              };
   
  $http.post('https://script.google.com/macros/s/AKfycbxXD35z5FSf_m_dwBt5qcBwWq2L7IDc7KBrYGfix6hUa4kvJ1TFpjU82NltFXezUroGgQ/exec', requestData, config)
    .then(function(response) { 
      $scope.companies = response.data.students;
      $scope.filterByActive()
    

  });
  
 


 

  $scope.returnDateFormat = function(date) {
    const dat = new Date(date);
    const optionsDate = { 
        weekday: 'long', 
        month: 'long', 
        day: 'numeric' 
    };
    const optionsTime = {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
    };

    var dateStr = dat.toLocaleDateString("es-MX", optionsDate).replace(",", "");
    dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
    var timeStr = dat.toLocaleTimeString("es-MX", optionsTime);
    return dateStr + ' - ' + timeStr;
};
    
     $scope.abrirNuevaPestana = function(URL) {
     const regex = /\/d\/([^\/]+)\//;
    const matches = URL.match(regex);
    var id = matches ? matches[1] : null;
     var url = "https://admin.mozartacademy.mx/edit?fileId="+id
    window.open(url, '_blank');
  };
    
    
    $scope.activeTab = 'Analytics'; // Tab por defecto

$scope.showTab = function(tabName) {
  $scope.activeTab = tabName;
};
    
    $scope.selectedCompany = '';
    
    $scope.showCompany = function(companyId, event) {
      event.preventDefault();
      $scope.selectedCompany = companyId;
      
      // For mobile view
      if (window.innerWidth <= 767) {
        document.querySelector('.list-panel').style.display = 'none';
        document.querySelector('.companies-panel').style.display = 'block';
      }
    };
    
    $scope.backToList = function() {
      // For mobile view
      if (window.innerWidth <= 767) {
        document.querySelector('.list-panel').style.display = 'block';
        document.querySelector('.companies-panel').style.display = 'none';
      }
    };
    
    // Handle window resize
    window.onresize = function() {
      if (window.innerWidth > 767) {
        document.querySelector('.list-panel').style.display = 'block';
        document.querySelector('.companies-panel').style.display = 'block';
      } else if ($scope.selectedCompany) {
        document.querySelector('.list-panel').style.display = 'none';
        document.querySelector('.companies-panel').style.display = 'block';
      } else {
        document.querySelector('.list-panel').style.display = 'block';
        document.querySelector('.companies-panel').style.display = 'none';
      }
    };


$scope.toggleAttendance = function(event) {
  if(event.attendance === 1) {
    event.attendance = 0;
  } else  {
    event.attendance = 1;
  } 
};

$scope.toggleLsn = function(lsn) {
  if(lsn.status != 'Evaluada') {
    lsn.status = 'Evaluada';
  } else  {
    lsn.status = 'Pendiente';
  } 
};


$scope.selectedOption = '1';
$scope.selectedOption2 = '1';
$scope.currentCompany = null; 
$scope.currentCompany2 = null; 
$scope.currentRecording = null; 
$scope.today = new Date().toISOString().split('T')[0];
$scope.newEvent = { title: '', date: '' };

$scope.openEditModal = function(company) {
    $scope.currentCompany = company; 
  $('#editModal').modal('show');
};

$scope.processOption = function() {
  if($scope.selectedOption == '1') {
    // Agregar nuevo evento al currentCompany
    var newEventObj = {
      title: $scope.newEvent.title,
      start: new Date($scope.newEvent.date),
      attendance: ''
    };
    
    if(!$scope.currentCompany.agenda) {
      $scope.currentCompany.agenda = []; // Inicializar array si no existe
    }
    
    $scope.currentCompany.agenda.push(newEventObj);
    $scope.newEvent = { title: '', date: '' }; // Limpiar campos
    
  } else if($scope.selectedOption == '2') {
    
  }
  
  $('#editModal').modal('hide');
};




$scope.openEditModal2 = function(company) {
    $scope.currentCompany2 = company; 
  $('#editModal2').modal('show');
};

$scope.processOption2 = function() {
  if($scope.selectedOption2 == '1') {
    // Agregar nuevo evento al currentCompany
    var newEventObj = {
      title: $scope.newEvent.title,
      start: new Date($scope.newEvent.date),
      attendance: ''
    };
    
    if(!$scope.currentCompany2.agenda) {
      $scope.currentCompany2.agenda = []; // Inicializar array si no existe
    }
    
    $scope.currentCompany2.agenda.push(newEventObj);
    $scope.newEvent = { title: '', date: '' }; // Limpiar campos
    
  } else if($scope.selectedOption2 == '2') {
    
  }
  
  $('#editModal2').modal('hide');
};






$scope.midiPlayer = null;
$scope.progressPercent = 0;
    

$scope.openPlayer = function(recording) {
      $scope.currentRecording = recording;
      $('#ap').css('display', 'block');

      if ($scope.midiPlayer) {
        $scope.midiPlayer.stop();
        $scope.midiPlayer.src = recording.midi;
        console.log('Archivo MIDI asignado:', recording.midi);
      }
    };
    
    $scope.closePlayer  = function() {
       $('#ap').css('display', 'none');
   $scope.currentRecording = null; 
   if ($scope.midiPlayer) $scope.midiPlayer.stop();
   
}
    

// Inicializar el reproductor
$scope.initPlayer = function() {
  $scope.midiPlayer = document.getElementById('midiPlayer');
  
  // Configurar eventos
  $scope.midiPlayer.addEventListener('ready', function() {
    $scope.$apply();
  });
  
  $scope.midiPlayer.addEventListener('pause', function() {
    $scope.$apply();
  });
  
  $scope.midiPlayer.addEventListener('play', function() {
    $scope.$apply();
  });
  
};

// Llamar a initPlayer cuando se carga la vista
$scope.initPlayer();







$scope.applyFilter = function() {
  switch($scope.selectedFilter) {
    case 'active':
      $scope.filterByActive();
      break;
    case 'now':
      $scope.filterByHour(); // Asumo que "Ahora" usa filterByHour
      break;
    case 'today':
      $scope.filterByDay();
      break;
    case 'all':
      $scope.showAllStudents(); 
      break;
    default:
      $scope.filterByActive();
  }
};



      $scope.filteredStudents = [];
       $scope.noStudentsMessage = '';

        $scope.filterByActive = function() {
    $scope.filteredStudents = $scope.companies.filter(function(student) {
      return student.status === 'ACTIVO';
    });
  };


  $scope.filterByDay = function() {
    $scope.filteredStudents = $scope.companies.filter(function(student) {
      return student.classtime.split(" ")[0] === $scope.getCurrentDay() && student.status === 'ACTIVO';
    });
     $scope.noStudentsMessage = $scope.filteredStudents.length === 0 ? 'No hay alumnos en este instante.' : '';
  };

  
  $scope.filterByHour = function() {
    $scope.filteredStudents = $scope.companies.filter(function(student) {
      return (student.classtime.split(" ")[0] === $scope.getCurrentDay() && parseInt(student.classtime.split(" ")[2].split(":")[0]) === $scope.getCurrentHour()  && student.status === 'ACTIVO');
    });
    $scope.noStudentsMessage = $scope.filteredStudents.length === 0 ? 'No hay alumnos en este instante.' : '';
  };
  
  
  $scope.showAllStudents = function() {
  $scope.filteredStudents = $scope.companies;
  $scope.noStudentsMessage = '';
};




   
    $scope.getCurrentDay = function() {
    var days = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
    var now = new Date();
    return days[now.getDay()];
  };

  $scope.getCurrentHour = function() {
    var now = new Date();
    var hours = now.getHours();
    return hours
  };
 



  }]);
</script>
